<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<title>HTC周年庆</title>
<script  src="//eshop.htc.com/wcsstore/Aurora/javascript/adobe/335b1986dd36e34720be128ac4a1ac495c6be031/satelliteLib-6099659899fdf1398b028eed0a7a5551410392e2.js"></script>
</head>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/jquery.downCount.js"></script>
<body>
<div class="htc_p1"></div>
<div class="htc_p2"></div>
<div class="htc_p3"></div>
<div class="htc_p4"></div>
<!--抽奖组件-->
<div class="htc_p4_box">
    <div id="lottery">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td class="options options-0" id="options-0"><img src="images/img_1.png"></td>
                <td class="options options-1" id="options-1"><img src="images/img_2.png"></td>
                <td class="options options-2" id="options-2"><img src="images/img_3.png"></td>
            </tr>
            <tr>
                <td class="options options-7" id="options-7"><img src="images/img_8.png"></td>
                <td colspan="0" rowspan="1" class="button"><a href="javascript:;"  id="act1" onclick=""><img src="images/img_9.png"></a></td>
                <td class="options options-3" id="options-3"><img src="images/img_4.png"></td>
            </tr>
            <tr>
                <td class="options options-6" id="options-6"><img src="images/img_7.png"></td>
                <td class="options options-5" id="options-5"><img src="images/img_6.png"></td>
                <td class="options options-4" id="options-4"><img src="images/img_5.png"></td>
            </tr>
        </table>
    </div>
    </div>
</div>
<!--获奖名单-->
<div class="htc_p5">
	<div class="htc_p5_box marquee">
	<table></table>
    </div>
</div>
<div class="htc_p6"></div>
<div class="htc_p7"></div>
<div class="htc_p8">
    <div class="htc_p8_time">
	<div id="timelag1status" style="width: 80px; color: rgb(255, 255, 255); position: absolute; font-size: 18px; font-weight: bold; margin-top: -4px; margin-left:345px;">距离活动开始时间</div>
        <!--倒计时-->
        <div class="time_box skl_item1" id="time_box skl_item1">
		
        	<!--<span class="days">03</span><span class="hours">00</span><span class="minutes">00</span><span class="seconds">21</span>-->
        </div>
    </div>
    <div class="htc_p8_box"><a  href="javascript:void(0)" id="act1" onclick="addtocart('163901','1')"></a></div>
</div>
<div class="htc_p9"></div>
<div class="htc_p10">
	<div class="htc_p10_time">
	<div id="timelag2status" style="width: 80px; color: rgb(255, 255, 255); position: absolute; font-size: 18px; font-weight: bold; margin-top: -4px; margin-left: -100px;">距离活动开始时间</div>
        <div class="time_box skl_item2" id="time_box skl_item2">
        <!--	<span class="days">03</span><span class="hours">00</span><span class="minutes">00</span><span class="seconds">21</span>-->
        </div>
    </div>
    <div class="htc_p10_box"><a  id="act2" href="javascript:void(0)" onclick="addtocart('163903','1')"></a></div>
</div>
<div class="htc_p11"></div>
<div class="htc_p12"><a href="http://eshop.htc.com/mall/zh-CN/htc/htc-a9w" target="_blank"></a></div>
<div class="htc_p13"><div class="htc_p13_box"><a target="_blank" href="http://eshop.htc.com/webapp/wcs/stores/servlet/SearchDisplay?searchTerm=%E5%91%A8%E5%B9%B4%E5%BA%86One-E9%2B&storeId=10001&catalogId=10001&langId=-7"></a><a target="_blank" href="http://eshop.htc.com/webapp/wcs/stores/servlet/SearchDisplay?searchTerm=%E5%91%A8%E5%B9%B4%E5%BA%86m8&storeId=10001&catalogId=10001&langId=-7" class=""></a></div></div>
<div class="htc_p15"><a href="http://eshop.htc.com/mall/zh-CN/htc/htc-x9?position=Nav4_1" target="_blank"></a></div>
<div class="htc_p16"><div class="htc_p16_box"><a  target="_blank"  href="http://eshop.htc.com/mall/zh-CN/htc/htc-D828w"></a><a target="_blank" href="http://eshop.htc.com/mall/zh-CN/htc/htc-d728w" class=""></a></div></div>
<div class="htc_p17">
	<div class="htc_p17_box"><a target="_blank" href="http://eshop.htc.com/mall/zh-CN/htc/allCategories/mobile?ntype=ecshop&position=Nav5"></a></div>
</div>
<div class="htc_p18"></div>
<div class="htc_p19"><div class="htc_p19_box"><a target="_blank"  href="http://eshop.htc.com/mall/zh-CN/htc/htc-15w"></a><a target="_blank" href="http://eshop.htc.com/mall/zh-CN/htc/htc-max500bx" class=""></a></div></div>
<div class="htc_p20"><div class="htc_p20_box"><a target="_blank" href="http://eshop.htc.com/mall/zh-CN/htc/allCategories/mobileAccessories?ntype=ecshop&position=Nav5"></a></div></div>
<div class="htc_p21"><div class="htc_p21_box"><a href="#"></a><a target="_blank" href="http://eshop.htc.com/mall/zh-CN/htc/allCategories?ntype=ecshop&position=Nav1" class="return"></a></div></div>

<div class="pop_box" id="pop_box"><span id="pop_boxspan"></span></div>
<input  type="hidden" id="timelag1active" value="1"/>
<input type="hidden"  id="timelag1" value="0"/>
<input  type="hidden"  id="timelag2active" value="1"/>
<input  type="hidden"  id="timelag2" value="0"/>
<script src="//eshop.htc.com/wcsstore/Aurora/new2014/js/campaign.js"></script>
<div id="hideIcon" style="display:none;"></div>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b6dfd61e83f245a50dcf7fe641a3c462";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script type="text/javascript">
jQuery(document).ready(function(){
  jQuery("#hideIcon").next().next().next().hide();
});
</script>
<script type="text/javascript">
    _satellite.pageBottom();
</script>
</body>
<script type="text/javascript">

//后台测试登录
var LoginURL = "/webapp/wcs/stores/servlet/LogonForm?catalogId=10001&myAcctMain=1&langId=-7&storeId=10001";
//添加购物车
var referralURL = "/webapp/wcs/stores/servlet/MyOrderReferral?catalogId=10001&langId=-7&flag=referral&storeId=10001&ReferralViewStyle=strong";
var cart1url="/webapp/wcs/stores/servlet/AjaxOrderItemDisplayView?catalogId=10001&langId=-7&storeId=10001&orderId=";
//第63次活动
var xlotteryId = "63";
//中奖位置
var prize1 = -1;
//建立一个json，初始化抽奖数据
var lottery={
	index:-1,	//当前转动到哪个位置，起点位置
	count:0,	//总共有多少个位置
	timer:0,	//setTimeout的ID，用clearTimeout清除
	speed:20,	//初始转动速度
	times:0,	//转动次数
	cycle:50,	//转动基本次数：即至少需要转动多少次再进入抽奖环节
	prize:0,	//中奖位置
	init:function(id){
		if ($("#"+id).find(".options").length>0) {
			$lottery = $("#"+id);
			$units = $lottery.find(".options");
			this.obj = $lottery;
			this.count = $units.length;
			$lottery.find(".options-"+this.index).addClass("current");
			
		};
	},
	roll:function(){
		var index = this.index;
		var count = this.count;
		var lottery = this.obj;
		$(lottery).find(".options-"+index).removeClass("current");
		index += 1;
		if (index>count-1) {
			index = 0;
		};
		$(lottery).find(".options-"+index).addClass("current");
		this.index=index;
		return false;
		
	},
	stop:function(index){
		this.prize=index;
		return false;

	}
};
//设置抽奖效摇滚速度果及中奖位置
function roll(){
	lottery.times += 1;
	lottery.roll();
	if (lottery.times > lottery.cycle+10 && lottery.prize==lottery.index) {
		clearTimeout(lottery.timer);
		lottery.prize=0;
		lottery.times=0;
		click=false;
		showPopBox();
	}else{
		if (lottery.times<lottery.cycle) {
			lottery.speed -= 10;
		}else if(lottery.times==lottery.cycle) {		
			lottery.prize = prize1;
		}else{
			if (lottery.times > lottery.cycle+10 && ((lottery.prize==0 && lottery.index==7) || lottery.prize==lottery.index+1)) {
				lottery.speed += 110;
			}else{
				lottery.speed += 20;
			}
		}
		if (lottery.speed<40) {
			lottery.speed=40;
		};
		lottery.timer = setTimeout(roll,lottery.speed);
	}
	return false;
}
//设置中奖弹出框文字
function showPopBox(){
	var content="<br>";
	if(prize1==0){
		$(".pop_box").html("<span>恭喜您获得了1元购买HTC One X9一台优惠券！"+content+"</span>");
	}else if(prize1==1){
		$("#pop_boxspan").html("<span>感谢参与！</span>");
	}else if(prize1==2){
		$(".pop_box").html("<span>恭喜您获得了999元购买HTC One X9一台优惠券！"+content+"</span>");
	}else if(prize1==3){
		$(".pop_box").html("<span>恭喜您获得了买手机送HTC蓝牙定位搜寻器（黑）优惠券！"+content+"</span>");
	}else if(prize1==4){
		$(".pop_box").html("<span>恭喜您获得了买手机送精美日历笔记本（含优惠券）优惠券！"+content+"</span>");
	}else if(prize1==5){
		$(".pop_box").html("<span>恭喜您获得了499元购买HTC Re如影相机优惠券！"+content+"</span>");
	}else if(prize1==6){
		$(".pop_box").html("<span>恭喜您获得了99元购买HTC E240入耳式耳机优惠券！"+content+"</span>");
	}else if(prize1==7){
		$(".pop_box").html("<span>恭喜您获得了再转一次！</span>");
	}
	prize1 = -1;
	$(".pop_box").show();
}
//点击抽奖开始数据交互
function imgClick(){
	$.ajax({
		  type: "POST",//用POST方式传输
		  cache: false,
		  url:'/webapp/wcs/stores/servlet/AjaxLotteryCmd',//目标地址
		  async:false,//作用是防止在ajax成功调用之前就调用$("#Pagination").pagination,这个时候数据个数还没有初始化
		  data:{"xlotteryId":xlotteryId},
		  dataType:'json',
		  success:function(data){ 
			if(data.success){
				prize1=data.angle;
			}else{
				if(data.message=="notLogin"){
					var returnURL =location.href;
					$(".pop_box").html("请<span ><a  style='color:#fff' href="+LoginURL+'&prevUrl='+encodeURIComponent(returnURL)+">登录</a></span>或<span class='color-green'><a  style='color:#fff' href="+LoginURL+'&prevUrl='+encodeURIComponent(returnURL)+">注册</a></span>");
					$(".pop_box").show();
				}else if(data.message=="invalid"){
					 prize1=-1;
					$(".pop_box").html("<span>对不起，该抽奖活动已经无效！</span>");
					$(".pop_box").show();
				}else if(data.message=="noChance"){
					prize1=-1;
					$(".pop_box").html("<span>您今天的抽奖机会已用完，请明天再来！</span>");
					$(".pop_box").show();
				}else if(data.message=="noShare"){
					prize1=-1;
					$(".pop_box").html("<span>非常抱歉，您还未参与HTC A9绝色分享活动 </span>");
					$(".pop_box").show();
				}
			
			}
		  }
	 });  
}
function show_date_time1(){  
    if($("#timelag1active").val()==1){
		window.setTimeout("show_date_time1()", 1000);  
		var timeold=$("#timelag1").val();
		$("#timelag1").val(timeold-1000);
		var sectimeold=timeold/1000;
		var secondsold=Math.floor(sectimeold);  
		var msPerDay=24*60*60*1000  
		var e_daysold=timeold/msPerDay  
		var daysold=Math.floor(e_daysold);  
		var e_hrsold=(e_daysold-daysold)*24;  
		var hrsold=Math.floor(e_hrsold);  
		var e_minsold=(e_hrsold-hrsold)*60;  
		var minsold=Math.floor((e_hrsold-hrsold)*60);  
		var seconds=Math.floor((e_minsold-minsold)*60); 
		if (timeold>0) {  
			if (daysold<10) {daysold="0"+daysold}  
			if (hrsold<10) {hrsold="0"+hrsold}  
			if (minsold<10) {minsold="0"+minsold}  
			if (seconds<10) {seconds="0"+seconds}  
			document.getElementById("time_box skl_item1").innerHTML='<span class="days">'+daysold+'</span><span class="hours">'+hrsold+'</span><span class="minutes">'+minsold+'</span><span class="seconds">'+seconds+'</span>';  
		} 
		
	} 
}
function show_date_time2(){  
    if($("#timelag2active").val()==1){
		window.setTimeout("show_date_time2()", 1000);  
		var timeold=$("#timelag2").val();
		$("#timelag2").val(timeold-1000);
		var sectimeold=timeold/1000;
		var secondsold=Math.floor(sectimeold);  
		var msPerDay=24*60*60*1000  
		var e_daysold=timeold/msPerDay  
		var daysold=Math.floor(e_daysold);  
		var e_hrsold=(e_daysold-daysold)*24;  
		var hrsold=Math.floor(e_hrsold);  
		var e_minsold=(e_hrsold-hrsold)*60;  
		var minsold=Math.floor((e_hrsold-hrsold)*60);  
		var seconds=Math.floor((e_minsold-minsold)*60); 
		if (timeold>0) {  
			if (daysold<10) {daysold="0"+daysold}  
			if (hrsold<10) {hrsold="0"+hrsold}  
			if (minsold<10) {minsold="0"+minsold}  
			if (seconds<10) {seconds="0"+seconds}  
			document.getElementById("time_box skl_item2").innerHTML='<span class="days">'+daysold+'</span><span class="hours">'+hrsold+'</span><span class="minutes">'+minsold+'</span><span class="seconds">'+seconds+'</span>';  
		} 
		
	} 
}
function addtocart(cid,aid){
	$.ajax({
		type: "POST",
		url:"/webapp/wcs/stores/servlet/XOrderItemAddActiveCmd",
		data:{
			activeid:aid,
			catentry_id:cid,
			requesttype:"ajax",
		},
		dataType:"json",
		success:function(data){
			var errorMessage = data.errorMessage;
			var errorMessageKey = data.errorMessageKey;
			if(errorMessage==null||errorMessage=='undefiend'){
				if(data.flag==3){
					$(".pop_box").html("<span>很抱歉，此商品已抢完</span>");
					$(".pop_box").show();
				}else if(data.flag==2){
					$(".pop_box").html("<span>活动尚未开始</span>");
					$(".pop_box").show();
				}else if(data.flag==1){
				  addtocart1(cid);
				}else{
					$(".pop_box").html("<span>添加失败请重试</span>");
					$(".pop_box").show();
				}
			}
		}
	});
}
function addtocart1(cid){
	$.ajax({
		type: "POST",
		url:"/webapp/wcs/stores/servlet/AjaxOrderChangeServiceItemAdd",
		data:{
			calculationUsage:"-1,-2,-5,-6,-7",
			catEntryId:cid,
			catalogId:"10001",
			comment:"normal",
			inventoryValidation:"true",
			langId:"-7",
			orderId:".",
			quantity:"1",
			requesttype:"ajax",
			storeId:"10001"
		},
		dataType:"json",
		success:function(data, textStatus){
			var errorMessage = data.errorMessage;
			var errorMessageKey = data.errorMessageKey;
			if(errorMessage==null||errorMessage=='undefiend'){
				location.href=cart1url+data.orderId;
			}else{
				if(errorMessageKey!=null&&errorMessageKey=='_API_CANT_RESOLVE_FFMCENTER'){
				$(".pop_box").html("<span>很抱歉，此商品已抢完</span>");
		    	$(".pop_box").show();	
				}else if(errorMessageKey!=null&&errorMessageKey=='_ERR_PROD_NOT_ORDERABLE'){
				$(".pop_box").html("<span>很抱歉，此商品已抢完</span>");
		    	$(".pop_box").show();
				}else if(errorMessageKey!=null&&errorMessageKey=='_ERR_EXCEEDED_MAXIMUM_EXCEPTION'){
				$(".pop_box").html("<span>超出最大购买数。</span>");
		    	$(".pop_box").show();
				}else{    
				$(".pop_box").html("<span>添加失败，请稍后再试！</span>");
		    	$(".pop_box").show();
				}
			}
	
		}
	});
}
function gettime(cid,aid,cs){
	$.ajax({
		type: "POST",
		url:"/webapp/wcs/stores/servlet/GetActiveTimeCmd",
		data:{
			activeId:aid,
			catentryId:cid,
			requesttype:"ajax",
		},
		dataType:"json",
		success:function(data){
		if(data==null){
			if(cs=="timelag1"){
				gettime('163901','1','timelag1');
			}else{
				gettime('163903','1','timelag2');
			}
		}else{
			var errorMessage = data.errorMessage;
			var errorMessageKey = data.errorMessageKey;
			if(errorMessage==null||errorMessage=='undefiend'){
			if(data.time==-1){
				$("."+cs).val("0");
				$("#"+cs+"active").val("0");
				 $("#"+cs+"status").html("暂无活动");
			}else if(data.time==0){
				$("#"+cs+"active").val("0");
				$("."+cs).val("0");
				$("#"+cs+"status").html("此商品已抢完");
			//更改时间
			}else if(data.time==2){
				var timelag=data.timelag
				$("#"+cs).val(timelag);
				$("#"+cs+"active").val("1");
				$("#"+cs+"status").html("距离活动开始时间");
			}else if(data.time==3){
				var timelag=data.timelag
				$("#"+cs).val(timelag);
				$("#"+cs+"active").val("1");
				 $("#"+cs+"status").html("距离活动结束时间");
			}
			}
			}
			}
	});
}
//获奖名单
function gotAward(){
	var len=$(".marquee table tr");
	 var k=0;
	 len.each(function(){
	   	k++;
		 if(k>7){
		   $(this).remove();
		  }
	  })
	$.ajax({
	  type: "POST",//用POST方式传输
	  cache: false,
	  url:'/webapp/wcs/stores/servlet/AjaxLotteryGotAwardCmd',//目标地址
	  async:false,//作用是防止在ajax成功调用之前就调用$("#Pagination").pagination,这个时候数据个数还没有初始化
	  data:{"xlotteryId":xlotteryId},
	  dataType:'json',
	  success:function(data){
		var list = data.dtoList;
			$.each(list,function(i,item){
			if(i<30){
				if(item.award!=="再转一次"){
					$(".marquee table").append("<tr style='text-align:center'><td style='width:25%;height:27px'>"+item.username+"<\/td><td style='width:30%;height:27px'> "+item.time+"<\/td><td style='width:45%;height:27px'>"+item.award+"<\/td><\/tr>"); 
					
				}
			}
		});
	  }
	});
}
var click=false;

window.onload=function(){
	lottery.init('lottery');
	$("#lottery a").click(function(){
		if (click) {
			return false;
		}else{
		    imgClick();
			lottery.speed=200;
			if(prize1!=-1)
			{roll();}
			click=true;
			return false;
		}
	});
	$(".pop_box").click(function(){
		$(".pop_box").hide();
		click=false;
	});
	$(function(){
	    gettime('163901','1','timelag1');
		gettime('163903','1','timelag2');
		show_date_time1();
		show_date_time2();
	});
	(function($){
		$.fn.myScroll = function(options){
			var defaults = {
				speed:100,  //滚动速度,值越大速度越慢
				rowHeight:27 //每行的高度
			};
			var opts = $.extend({}, defaults, options);
			var intId = [];
			function marquee(obj, step){
				obj.find("table").animate({
					marginTop: '-=1'
				},0,function(){
					var s = Math.abs(parseInt($(this).css("margin-top")));
					if(s >= step){
						$(this).find("tr").slice(0, 1).appendTo($(this));
						$(this).css("margin-top", 0);
					}
				});
			}
			this.each(function(i){
				var sh = opts["rowHeight"];
				var speed = opts["speed"];
				var _this = $(this);
				intId[i] = setInterval(function(){
					if(_this.find("table").height()<=_this.height()){
						clearInterval(intId[i]);
					}else{
						marquee(_this, sh);
					}
				}, speed);
				_this.hover(function(){
					clearInterval(intId[i]);
				},function(){
					intId[i] = setInterval(function(){
						if(_this.find("table").height()<=_this.height()){
							clearInterval(intId[i]);
						}else{
							marquee(_this, sh);
						}
					}, speed);
				});
			});
		}
	})(jQuery);
	$(function(){
	   gotAward();
		$("div.marquee").myScroll({
			speed:50,
			rowHeight:27
		});
	});
};
window.setInterval(gotAward,60000);
</script>

</html>
